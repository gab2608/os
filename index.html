<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Envoyer texte BLE</title>
</head>
<body style="text-align:center; margin-top:40px;">
  <h2>Envoyer du texte via BLE</h2>
  <button id="connect">Se connecter au PC</button><br><br>
  <input id="msg" type="text" placeholder="Message...">
  <button id="send">Envoyer</button>

  <script>
    let characteristic;

    document.getElementById("connect").onclick = async () => {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: "BLE" }],
          optionalServices: ["12345678-1234-5678-1234-56789abcdef0"]
        });
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService("12345678-1234-5678-1234-56789abcdef0");
        characteristic = await service.getCharacteristic("abcdef01-1234-5678-1234-56789abcdef0");
        alert("Connecté !");
      } catch (err) {
        alert("Erreur : " + err);
      }
    };

    document.getElementById("send").onclick = async () => {
      if (!characteristic) return alert("Pas connecté !");
      const text = document.getElementById("msg").value;
      const encoder = new TextEncoder();
      await characteristic.writeValue(encoder.encode(text));
      alert("Envoyé : " + text);
    };
  </script>
</body>
</html>
